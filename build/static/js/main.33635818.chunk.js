(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{233:function(e,t,n){},234:function(e,t,n){"use strict";n.r(t);var a=n(4),r=n(0),c=n(80),o=n.n(c),s=n(13),i=n(207),l=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,262)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,c=t.getLCP,o=t.getTTFB;n(e),a(e),r(e),c(e),o(e)}))},u=n(41),j=n(19),d=n(251),b=n(18),m=n(254),O=n(42),h=n(200),p={user:null};if(localStorage.getItem("jwtToken")){var x=Object(h.a)(localStorage.getItem("jwtToken"));1e3*x.exp<Date.now()?localStorage.removeItem("jwtToken"):p.user=x}var g=Object(r.createContext)({user:null,login:function(e){},logout:function(){}});function f(e,t){switch(t.type){case"LOGIN":return Object(O.a)(Object(O.a)({},e),{},{user:t.payload});case"LOGOUT":return Object(O.a)(Object(O.a)({},e),{},{user:null});default:return e}}function v(e){var t=Object(r.useReducer)(f,p),n=Object(b.a)(t,2),c=n[0],o=n[1];return Object(a.jsx)(g.Provider,Object(O.a)({value:{user:c.user,login:function(e){localStorage.setItem("jwtToken",e.token),o({type:"LOGIN",payload:e})},logout:function(){localStorage.removeItem("jwtToken"),o({type:"LOGOUT"})}}},e))}var C=function(){var e=Object(r.useContext)(g),t=e.user,n=e.logout,c=window.location.pathname,o="/"===c?"home":c.substr(1),s=Object(r.useState)(o),i=Object(b.a)(s,2),l=i[0],j=i[1],d=function(e,t){var n=t.name;return j(n)};return t?Object(a.jsxs)(m.a,{pointing:!0,secondary:!0,size:"massive",color:"teal",children:[Object(a.jsx)(m.a.Item,{name:"\u3088\u3046\u3053\u305d "+t.username+" \u3055\u3093",as:u.b,to:"/"}),Object(a.jsx)(m.a.Menu,{position:"right",children:Object(a.jsx)(m.a.Item,{name:"logout",onClick:n})})]}):Object(a.jsxs)(m.a,{pointing:!0,secondary:!0,size:"massive",color:"teal",children:[Object(a.jsx)(m.a.Item,{name:"home",active:"home"===l,onClick:d,as:u.b,to:"/"}),Object(a.jsxs)(m.a.Menu,{position:"right",children:[Object(a.jsx)(m.a.Item,{name:"login",active:"login"===l,onClick:d,as:u.b,to:"/login"}),Object(a.jsx)(m.a.Item,{name:"register",active:"register"===l,onClick:d,as:u.b,to:"/register"})]})]})},y=n(260),I=n(255),w=n(257),k=n(206),P=n(258),S=n(111),$=n(156),A=n(118),N=n.n(A),q=n(28);function D(){var e=Object(q.a)(["\nmutation likePost($postId: ID!) {\n    likePost(postId: $postId) {\n        id\n        likes {\n            id\n            username\n        }\n        likeCount\n    }\n}\n"]);return D=function(){return e},e}var L=Object(s.gql)(D()),M=n(252);var T=function(e){var t=e.content,n=e.children;return Object(a.jsx)(M.a,{inverted:!0,content:t,trigger:n})};var E=function(e){var t=e.user,n=e.post,c=n.id,o=n.likeCount,i=n.likes,l=Object(r.useState)(!1),j=Object(b.a)(l,2),d=j[0],m=j[1];Object(r.useEffect)((function(){t&&i.find((function(e){return e.username===t.username}))?m(!0):m(!1)}),[t,i]);var O=Object(s.useMutation)(L,{variables:{postId:c}}),h=Object(b.a)(O,1)[0],p=t?d?Object(a.jsx)(P.a,{color:"teal",children:Object(a.jsx)(S.a,{name:"heart"})}):Object(a.jsx)(P.a,{color:"teal",basic:!0,children:Object(a.jsx)(S.a,{name:"heart"})}):Object(a.jsx)(P.a,{as:u.b,to:"/login",color:"teal",basic:!0,children:Object(a.jsx)(S.a,{name:"heart"})});return Object(a.jsxs)(P.a,{as:"div",labelPosition:"right",onClick:h,children:[Object(a.jsx)(T,{content:d?"unlike":"like",children:p}),Object(a.jsx)($.a,{basic:!0,color:"teal",pointing:"left",children:o})]})},Q=n(155),R=n(256);function F(){var e=Object(q.a)(["\n{\n    getPosts {\n        id\n        body\n        createdAt\n        username\n        likeCount\n        likes {\n            username\n        }\n        commentCount\n        comments {\n            id\n            username\n            createdAt\n            body\n        }\n    }\n}\n"]);return F=function(){return e},e}var U=Object(s.gql)(F());function z(){var e=Object(q.a)(["\n    mutation deletePost($postId: ID!) {\n        deletePost(postId: $postId) \n    }\n"]);return z=function(){return e},e}var G=Object(s.gql)(z());function H(){var e=Object(q.a)(["\n    mutation deleteComment($postId: ID!, $commentId: ID!) {\n        deleteComment(postId: $postId, commentId: $commentId) {\n            id\n            comments {\n                id\n                username\n                createdAt\n                body\n            }\n            commentCount\n        }\n    }\n"]);return H=function(){return e},e}var B=Object(s.gql)(H());var J=function(e){var t=e.postId,n=e.commentId,c=e.callback,o=Object(r.useState)(!1),i=Object(b.a)(o,2),l=i[0],u=i[1],j=n?B:G,d=Object(s.useMutation)(j,{update:function(e){if(u(!1),!n){var a=e.readQuery({query:U}).getPosts.filter((function(e){return e.id!==t}));e.writeQuery({query:U,data:{getPosts:Object(Q.a)(a)}})}c&&c()},variables:{postId:t,commentId:n}}),m=Object(b.a)(d,1)[0];return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)(T,{content:n?"Delete Comment":"Delete Post",children:Object(a.jsx)(P.a,{as:"div",color:"red",floated:"right",onClick:function(){return u(!0)},children:Object(a.jsx)(S.a,{name:"trash",style:{margin:0}})})}),Object(a.jsx)(R.a,{open:l,onCancel:function(){return u(!1)},onConfirm:m})]})},V=function(e){var t=e.post,n=t.body,c=t.createdAt,o=t.id,s=t.username,i=t.likeCount,l=t.commentCount,j=t.likes,d=Object(r.useContext)(g).user;return Object(a.jsxs)(w.a,{fluid:!0,children:[Object(a.jsxs)(w.a.Content,{children:[Object(a.jsx)(k.a,{floated:"right",size:"mini",src:"https://react.semantic-ui.com/images/avatar/large/molly.png"}),Object(a.jsx)(w.a.Header,{children:s}),Object(a.jsx)(w.a.Meta,{as:u.b,to:"/posts/".concat(o),children:N()(c).fromNow(!0)}),Object(a.jsx)(w.a.Description,{children:n})]}),Object(a.jsxs)(w.a.Content,{extra:!0,children:[Object(a.jsx)(E,{user:d,post:{id:o,likes:j,likeCount:i}}),Object(a.jsx)(T,{content:"Comment on Post",children:Object(a.jsxs)(P.a,{labelPosition:"right",as:u.b,to:"/posts/".concat(o),children:[Object(a.jsx)(P.a,{color:"blue",basic:!0,children:Object(a.jsx)(S.a,{name:"comments"})}),Object(a.jsx)($.a,{basic:!0,color:"blue",pointing:"left",children:l})]})}),d&&d.username===s&&Object(a.jsx)(J,{postId:o})]})]})},W=n(253),K=n(130),X=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Object(r.useState)(t),a=Object(b.a)(n,2),c=a[0],o=a[1],s=function(e){o(Object(O.a)(Object(O.a)({},c),{},Object(K.a)({},e.target.name,e.target.value)))},i=function(t){t.preventDefault(),e()};return{onChange:s,onSubmit:i,values:c}};function Y(){var e=Object(q.a)(["\n    mutation createPost($body: String!) {\n        createPost(body: $body) {\n            id\n            body\n            createdAt\n            username\n            likes {\n                id\n                username\n                createdAt\n            }\n            likeCount\n            comments {\n                id\n                body\n                username\n                createdAt\n            }\n            commentCount\n        }\n    }\n"]);return Y=function(){return e},e}var Z=Object(s.gql)(Y());var _=function(){var e=X((function(){i()}),{body:""}),t=e.values,n=e.onChange,r=e.onSubmit,c=Object(s.useMutation)(Z,{variables:t,update:function(e,n){var a=e.readQuery({query:U});e.writeQuery({query:U,data:{getPosts:[n.data.createPost].concat(Object(Q.a)(a.getPosts))}}),t.body=""}}),o=Object(b.a)(c,2),i=o[0],l=o[1].error;return Object(a.jsx)(a.Fragment,{children:Object(a.jsxs)(W.a,{onSubmit:r,children:[Object(a.jsx)("h2",{children:"Create a Post:"}),Object(a.jsxs)(W.a.Field,{children:[Object(a.jsx)(W.a.Input,{placeholder:"Hi World!",name:"body",onChange:n,value:t.body,error:!!l}),Object(a.jsx)(P.a,{type:"submit",color:"teal",children:"Submit"})]})]})})},ee=function(){var e=Object(r.useContext)(g).user,t=Object(s.useQuery)(U),n=t.loading,c=t.data;return Object(a.jsxs)(y.a,{columns:3,divided:!0,children:[Object(a.jsx)(y.a.Row,{className:"page-title",children:Object(a.jsx)("h1",{children:"Recent Posts"})}),Object(a.jsxs)(y.a.Row,{children:[e&&Object(a.jsx)(y.a.Column,{children:Object(a.jsx)(_,{})}),n?Object(a.jsx)("h1",{children:"Loading ..."}):Object(a.jsx)(I.a.Group,{children:c.getPosts&&c.getPosts.map((function(e){return Object(a.jsx)(y.a.Column,{style:{marginBottom:20},children:Object(a.jsx)(V,{post:e})},e.id)}))})]})]})};function te(){var e=Object(q.a)(["\n    mutation login(\n        $username: String!\n        $password: String!\n    ) {\n        login(\n            username: $username,\n            password: $password,\n        ) {\n            id\n            email\n            username\n            createdAt\n            token\n        }\n    }\n"]);return te=function(){return e},e}var ne=Object(s.gql)(te()),ae=function(e){var t=Object(r.useContext)(g),n=Object(r.useState)({}),c=Object(b.a)(n,2),o=c[0],i=c[1],l=X((function(){h()}),{username:"",password:""}),u=l.onChange,j=l.onSubmit,d=l.values,m=Object(s.useMutation)(ne,{update:function(n,a){var r=a.data.login;t.login(r),e.history.push("/")},onError:function(e){i(e.graphQLErrors[0].extensions.exception.errors)},variables:d}),O=Object(b.a)(m,2),h=O[0],p=O[1].loading;return Object(a.jsxs)("div",{className:"form-container",children:[Object(a.jsxs)(W.a,{onSubmit:j,noValidate:!0,className:p?"loading":"",children:[Object(a.jsx)("h1",{children:"Login"}),Object(a.jsx)(W.a.Input,{label:"Username",placeholder:"Username",name:"username",type:"text",value:d.username,error:!!o.username,onChange:u}),Object(a.jsx)(W.a.Input,{label:"Password",placeholder:"Password",name:"password",type:"password",value:d.password,error:!!o.password,onChange:u}),Object(a.jsx)(P.a,{type:"submit",primary:!0,children:"Login"})]}),Object.keys(o).length>0&&Object(a.jsx)("div",{className:"ui error message",children:Object(a.jsx)("ul",{className:"list",children:Object.values(o).map((function(e){return Object(a.jsx)("li",{children:e},e)}))})})]})};function re(){var e=Object(q.a)(["\n    mutation register(\n        $username: String!\n        $email: String!\n        $password: String!\n        $confirmPassword: String!\n    ) {\n        register(\n            registerInput: {\n                username: $username,\n                email: $email,\n                password: $password,\n                confirmPassword: $confirmPassword\n            }\n        ) {\n            id\n            email\n            username\n            createdAt\n            token\n        }\n    }\n"]);return re=function(){return e},e}var ce=Object(s.gql)(re()),oe=function(e){var t=Object(r.useContext)(g),n=Object(r.useState)({}),c=Object(b.a)(n,2),o=c[0],i=c[1],l=X((function(){h()}),{username:"",email:"",password:"",confirmPassword:""}),u=l.onChange,j=l.onSubmit,d=l.values,m=Object(s.useMutation)(ce,{update:function(n,a){var r=a.data.register;t.login(r),e.history.push("/")},onError:function(e){i(e.graphQLErrors[0].extensions.exception.errors)},variables:d}),O=Object(b.a)(m,2),h=O[0],p=O[1].loading;return Object(a.jsxs)("div",{className:"form-container",children:[Object(a.jsxs)(W.a,{onSubmit:j,noValidate:!0,className:p?"loading":"",children:[Object(a.jsx)("h1",{children:"Register"}),Object(a.jsx)(W.a.Input,{label:"Username",placeholder:"Username",name:"username",type:"text",value:d.username,error:!!o.username,onChange:u}),Object(a.jsx)(W.a.Input,{label:"Email",placeholder:"Email",name:"email",type:"email",value:d.email,error:!!o.email,onChange:u}),Object(a.jsx)(W.a.Input,{label:"Password",placeholder:"Password",name:"password",type:"password",value:d.password,error:!!o.password,onChange:u}),Object(a.jsx)(W.a.Input,{label:"Confirm Password",placeholder:"Confirm Password",name:"confirmPassword",type:"password",value:d.confirmPassword,error:!!o.confirmPassword,onChange:u}),Object(a.jsx)(P.a,{type:"submit",primary:!0,children:"Register"})]}),Object.keys(o).length>0&&Object(a.jsx)("div",{className:"ui error message",children:Object(a.jsx)("ul",{className:"list",children:Object.values(o).map((function(e){return Object(a.jsx)("li",{children:e},e)}))})})]})};function se(){var e=Object(q.a)(["\n    query($postId: ID!) {\n        getPost(postId: $postId) {\n            id\n            body\n            createdAt\n            username\n            likeCount\n            likes {\n                username\n            }\n            commentCount\n            comments {\n                id\n                username\n                createdAt\n                body\n            }\n        }\n    }\n"]);return se=function(){return e},e}var ie=Object(s.gql)(se());function le(){var e=Object(q.a)(["\n    mutation($postId: String!, $body: String!) {\n        createComment(postId: $postId, body: $body) {\n            id\n            comments {\n                id\n                body\n                createdAt\n                username\n            }\n            commentCount\n        }\n    }\n"]);return le=function(){return e},e}var ue=Object(s.gql)(le());var je=function(e){var t,n=Object(r.useState)(""),c=Object(b.a)(n,2),o=c[0],i=c[1],l=e.match.params.postId,u=Object(r.useContext)(g).user,j=Object(r.useRef)(null),d=Object(s.useQuery)(ie,{variables:{postId:l}}).data,m=Object(s.useMutation)(ue,{update:function(){i("")},variables:{postId:l,body:o}}),O=Object(b.a)(m,1)[0];if(d){var h=d.getPost,p=h.id,x=h.body,f=h.createdAt,v=h.username,C=h.comments,I=h.likes,A=h.likeCount,q=h.commentCount;t=Object(a.jsx)(y.a,{children:Object(a.jsxs)(y.a.Row,{children:[Object(a.jsx)(y.a.Column,{width:2,children:Object(a.jsx)(k.a,{src:"https://react.semantic-ui.com/images/avatar/large/molly.png",size:"small",float:"right"})}),Object(a.jsxs)(y.a.Column,{width:10,children:[Object(a.jsxs)(w.a,{fluid:!0,children:[Object(a.jsxs)(w.a.Content,{children:[Object(a.jsx)(w.a.Header,{children:v}),Object(a.jsx)(w.a.Meta,{children:N()(f).fromNow()}),Object(a.jsx)(w.a.Description,{children:x})]}),Object(a.jsx)("hr",{}),Object(a.jsxs)(w.a.Content,{extra:!0,children:[Object(a.jsx)(E,{user:u,post:{id:p,likeCount:A,likes:I}}),Object(a.jsx)(T,{content:"Comment on Post",children:Object(a.jsxs)(P.a,{as:"div",labelPosition:"right",onClick:function(){return console.log("comment on post")},children:[Object(a.jsx)(P.a,{basic:!0,color:"blue",children:Object(a.jsx)(S.a,{name:"comments"})}),Object(a.jsx)($.a,{basic:!0,color:"blue",pointing:"left",children:q})]})}),u&&u.username===v&&Object(a.jsx)(J,{postId:p,callback:function(){e.history.push("/")}})]})]}),u&&Object(a.jsx)(w.a,{fluid:!0,children:Object(a.jsxs)(w.a.Content,{children:[Object(a.jsx)("p",{children:"Post a Comment"}),Object(a.jsx)(W.a,{children:Object(a.jsxs)("div",{className:"ui action input fluid",children:[Object(a.jsx)("input",{type:"text",placeholder:"\u30b3\u30e1\u30f3\u30c8",name:"comment",value:o,onChange:function(e){return i(e.target.value)},ref:j}),Object(a.jsx)("button",{type:"submit",className:"ui button teal",disabled:""===o.trim(),onClick:O,children:"\u6295\u7a3f"})]})})]})}),C.map((function(e){return Object(a.jsx)(w.a,{fluid:!0,children:Object(a.jsxs)(w.a.Content,{children:[u&&u.username===e.username&&Object(a.jsx)(J,{postId:p,commentId:e.id}),Object(a.jsx)(w.a.Header,{children:e.username}),Object(a.jsx)(w.a.Meta,{children:N()(e.createdAt).fromNow()}),Object(a.jsx)(w.a.Description,{children:e.body})]})},e.id)}))]})]})})}else t=Object(a.jsx)("p",{children:"Loading post ..."});return t},de=n(205);var be=function(e){var t=e.component,n=Object(de.a)(e,["component"]),c=Object(r.useContext)(g).user;return Object(a.jsx)(j.b,Object(O.a)(Object(O.a)({},n),{},{render:function(e){return c?Object(a.jsx)(j.a,{to:"/"}):Object(a.jsx)(t,Object(O.a)({},e))}}))};n(232),n(233);var me=function(){return Object(a.jsx)(v,{children:Object(a.jsx)(u.a,{children:Object(a.jsxs)(d.a,{children:[Object(a.jsx)(C,{}),Object(a.jsx)(j.b,{exact:!0,path:"/",component:ee}),Object(a.jsx)(be,{exact:!0,path:"/login",component:ae}),Object(a.jsx)(be,{exact:!0,path:"/register",component:oe}),Object(a.jsx)(j.b,{exact:!0,path:"/posts/:postId",component:je})]})})})},Oe=Object(s.createHttpLink)({uri:"http://localhost:4000"}),he=Object(i.a)((function(){var e=localStorage.getItem("jwtToken");return{headers:{Authorization:e?"Bearer ".concat(e):""}}})),pe=new s.ApolloClient({link:he.concat(Oe),cache:new s.InMemoryCache});o.a.render(Object(a.jsx)(s.ApolloProvider,{client:pe,children:Object(a.jsx)(me,{})}),document.getElementById("root")),l()}},[[234,1,2]]]);
//# sourceMappingURL=main.33635818.chunk.js.map